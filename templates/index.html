{% extends "base.html" %}

{% block title %}Practice{% endblock %}

{% block content %}
<!-- Thesis Assets: WaveSurfer and Lame.js -->
<script src="https://unpkg.com/wavesurfer.js@7.5.0/dist/wavesurfer.min.js"></script>
<script src="https://unpkg.com/lamejs@1.2.0/lame.min.js"></script>

<div class="max-w-5xl mx-auto space-y-6">

    <!-- 0. Participant Information (Now Read-Only from Session) -->
    <section id="student-section" class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
        <div class="flex flex-col lg:flex-row lg:items-center justify-between gap-6">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 flex-1">
                <div>
                    <label class="block text-[10px] font-black text-slate-400 uppercase tracking-widest mb-1">Student Name</label>
                    <input id="student-name" type="text" value="{{ current_user.first_name }} {{ current_user.last_name }}" readonly 
                           class="w-full bg-slate-50 border-none text-slate-700 font-bold rounded-lg p-2 focus:ring-0">
                </div>
                <div>
                    <label class="block text-[10px] font-black text-slate-400 uppercase tracking-widest mb-1">Student ID</label>
                    <input id="student-id" type="text" value="{{ current_user.student_id }}" readonly 
                           class="w-full bg-slate-50 border-none text-slate-700 font-mono rounded-lg p-2 focus:ring-0">
                </div>
            </div>

            <div class="flex flex-wrap items-center gap-4">
                <div class="flex flex-col">
                    <label class="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-1">Test Phase</label>
                    <select id="test-type" class="bg-slate-50 border border-slate-200 text-slate-900 text-sm rounded-lg p-2 font-bold outline-none">
                        <option value="pre">Pre-test</option>
                        <option value="post">Post-test</option>
                    </select>
                </div>

                <!-- Noise Monitoring UI -->
                <div id="noise-status-container" class="flex items-center bg-slate-50 px-4 py-2 rounded-lg border border-slate-100 min-w-[200px]">
                    <div id="noise-indicator-icon" class="w-3 h-3 rounded-full bg-gray-300 mr-3"></div>
                    <div class="flex flex-col">
                        <span id="noise-indicator-text" class="text-[10px] font-bold text-slate-400 uppercase">Mic Noise</span>
                        <span id="noise-level-display" class="text-sm font-black text-indigo-600">-- dB</span>
                    </div>
                </div>
            </div>
        </div>
        <div id="student-msg" class="mt-2 text-xs text-rose-500 font-bold"></div>
    </section>

    <!-- 1. Word List -->
    <section id="input-section" class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
        <h2 class="text-xs font-black text-slate-400 uppercase tracking-widest mb-4">Select a Word</h2>
        <div id="word-list" class="grid grid-cols-2 sm:grid-cols-4 md:grid-cols-5 gap-3">
            <!-- Populated by script.js -->
        </div>
    </section>

    <!-- 2 & 3. Waveforms -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <!-- Sample Section -->
        <section id="sample-section" class="bg-white p-6 rounded-xl shadow-sm border border-slate-200 space-y-4">
            <div class="flex justify-between items-center">
                <h2 class="font-bold text-slate-700 uppercase text-xs tracking-widest">Model: <span id="sample-word-placeholder" class="text-indigo-600 ml-2">---</span></h2>
                <button id="play-sample" class="bg-slate-900 text-white px-4 py-2 rounded-lg text-xs font-bold hover:bg-slate-700 disabled:opacity-30 transition">
                    <i class="fas fa-play mr-1"></i> Play Sample
                </button>
            </div>
            <div id="sample-message" class="text-xs italic text-indigo-500 min-h-[1rem]"></div>
            <div id="sample-waveform-container" class="h-24 bg-slate-50 rounded-lg border border-slate-100 overflow-hidden"></div>
        </section>

        <!-- Your Pronunciation Section -->
        <section id="record-section" class="bg-white p-6 rounded-xl shadow-sm border border-slate-200 space-y-4">
            <h2 class="font-bold text-slate-700 uppercase text-xs tracking-widest">Your Recording</h2>
            <div class="flex gap-2">
                <button id="record-start" class="flex-1 bg-rose-600 text-white py-2 rounded-lg font-bold hover:bg-rose-700 transition">Begin Recording</button>
                <button id="record-stop" class="flex-1 bg-slate-200 text-slate-400 py-2 rounded-lg font-bold disabled:opacity-50" disabled>Stop</button>
                <button id="play-user" class="w-12 bg-indigo-50 text-indigo-700 rounded-lg disabled:opacity-30" disabled><i class="fas fa-play"></i></button>
            </div>
            <div id="user-waveform-container" class="h-24 bg-slate-50 rounded-lg border border-slate-100 overflow-hidden"></div>
        </section>
    </div>

    <!-- 4. Comparison & Submit -->
    <section id="difference-section" class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
        <h2 class="text-xs font-black text-slate-400 uppercase tracking-widest mb-4">Acoustic Comparison</h2>
        <div id="difference-waveform-container" class="h-32 bg-slate-900 rounded-xl mb-6 border-4 border-slate-800 overflow-hidden"></div>
        
        <div class="flex flex-col sm:flex-row items-center justify-between gap-4">
            <div id="message-box" class="text-sm font-bold text-slate-600"></div>
            <div class="flex items-center gap-4">
                <span id="submit-msg" class="text-xs font-bold text-emerald-600"></span>
                <button id="submit-recording" class="bg-indigo-600 text-white px-10 py-4 rounded-2xl font-black uppercase tracking-widest shadow-xl hover:bg-indigo-700 disabled:opacity-20 transition" disabled>
                    Submit Recording
                </button>
            </div>
        </div>
    </section>

</div>

<script src="{{ url_for('static', filename='js/script.js') }}"></script>
{% endblock %}